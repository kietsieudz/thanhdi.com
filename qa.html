<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>H·ªèi ƒë√°p ‚Äì H∆∞·ªõng d·∫´n ch∆°i | TDStudio</title>
    <meta name="description"
      content="Th∆∞ vi·ªán Q&A h∆∞·ªõng d·∫´n ch∆°i: t√¢n th·ªß, c√†y s·ª©c m·∫°nh, ch·ªâ s·ªë, boss, giftcode... T√¨m nhanh, l·ªçc theo th·ªÉ lo·∫°i, h∆∞·ªõng d·∫´n t·ª´ng b∆∞·ªõc." />
    <meta name="theme-color" content="#0ea5e9" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet">

    <style>
    :root{
      --bg:#0b1220; --card:#0f172a; --muted:#9db0c5; --text:#e6eef6;
      --pri:#0ea5e9; --pri-2:#22d3ee; --border:#1e293b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:var(--pri);text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:980px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;z-index:20;background:linear-gradient(#0b1220,rgba(11,18,32,.85) 60%,rgba(11,18,32,0));backdrop-filter:saturate(120%) blur(6px)}
    .hstack{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .brand{font-weight:800;letter-spacing:.2px}
    .pill{border:1px solid var(--border);background:var(--card);color:var(--text);padding:10px 12px;border-radius:12px}
    .search{flex:1;display:flex;align-items:center;gap:10px}
    .search input{width:100%;background:transparent;border:none;outline:none;color:var(--text)}
    .search .wrap{flex:1;border:1px solid var(--border);background:var(--card);border-radius:12px;padding:10px 12px;display:flex;gap:8px;align-items:center}
    .kbd{font:600 12px/1 Inter,ui-sans-serif;background:#101826;border:1px solid #1f2a44;border-bottom-color:#142036;padding:3px 6px;border-radius:6px;color:#c9d7ec}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    select,button{background:var(--card);border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:12px}
    button:hover{border-color:#2b3a55}
    .counter{color:var(--muted);font-size:14px}

    .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:16px}
    @media(min-width:720px){ .grid{grid-template-columns:1fr 1fr} }

    /* === CARD Q&A === */
    .qa {
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: 16px;
      overflow: hidden;
      transition: border-color .2s, background .2s;
    }
    .qa:hover { border-color: var(--pri); background: #132136; }

    /* H√†ng ti√™u ƒë·ªÅ (Top row) */
    .q-head {
      display:flex; align-items:center; gap:12px;
      padding: 14px 18px 8px 18px; cursor:pointer;
    }
    .q-icon {
      width: 34px; height: 34px; border-radius: 10px;
      background: linear-gradient(135deg, var(--pri), var(--pri-2));
      display: grid; place-items: center; font-weight: 800; color: #00131a; flex:0 0 34px;
    }
    .q-title {
      font-weight: 600; font-size: 15px; line-height:1.3;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex:1; min-width:0;
    }

    /* H√†ng meta (Bottom row) */
    .q-meta-row{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; padding: 0 18px 12px 18px; cursor:pointer;
    }
    .q-meta-left{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
    .q-badge, .q-views {
      font-size: 13px; color:#b8c8db; border:1px solid var(--border);
      padding:4px 10px; border-radius:8px; white-space:nowrap; background:#0e1a2b;
    }
    .q-views::before{content:"üëÅ "; opacity:.9}
    .q-actions button {
      font-size: 13px; border:1px solid var(--border); padding:5px 10px;
      border-radius:8px; color:var(--pri); background:transparent; cursor:pointer; transition:all .15s;
    }
    .q-actions button:hover { background: rgba(34,211,238,0.1); border-color: var(--pri); }

    /* N·ªôi dung tr·∫£ l·ªùi */
    .a-body { padding: 0 18px 16px 64px; display:none; line-height:1.6; }
    .a-body.active { display:block; animation: fade .15s ease; }
    @keyframes fade{from{opacity:0;transform:translateY(-2px)}to{opacity:1;transform:translateY(0)}}
    .a-intro{color:#d7e5f7;margin:4px 0 8px 0}
    .steps{margin:0;padding-left:18px}
    .steps li{margin:4px 0}
    .tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .tag{font-size:12px;background:#0f1a2a;border:1px solid #1a2942;color:#9db0c5;padding:4px 8px;border-radius:8px}
    .imgs{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding:6px 6px 10px 6px;
  scroll-snap-type:x mandatory;
}
.img{
  flex:0 0 280px;        /* = chi·ªÅu r·ªông c·ªë ƒë·ªãnh */
  height:160px;          /* = chi·ªÅu cao c·ªë ƒë·ªãnh */
  border:1px solid #1e2b44;
  border-radius:14px;
  overflow:hidden;
  background:#0b1527;
  cursor:zoom-in;
  scroll-snap-align:start;
}
.img img{
  width:100%;
  height:100%;
  object-fit:cover;      /* t·ª± crop ƒë·ªÉ v·ª´a khung */
  display:block;
}
/* t·∫°o c·∫£m gi√°c c√≤n ·∫£nh ph√≠a sau */
.imgs::after{ content:""; flex:0 0 36px; }
    .muted{color:var(--muted)}
    .empty{border:1px dashed #2b3a55;border-radius:14px;padding:18px;text-align:center;color:#9db0c5}

    dialog#light{border:none;border-radius:12px;padding:0;background:transparent}
    dialog::backdrop{background:rgba(0,0,0,.7)}
    .light-wrap{background:#000;border-radius:12px;overflow:hidden;max-width:95vw;max-height:90vh}
    .light-wrap img{display:block;max-width:95vw;max-height:90vh}
    .light-top{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;background:rgba(10,10,10,.7)}
    .light-top button{font-size:14px}

    footer{margin:24px 0 40px;color:var(--muted);text-align:center}
    mark{background:linear-gradient(0deg,rgba(34,211,238,.25),rgba(34,211,238,.25));color:#eaffff;border-radius:4px;padding:0 2px}

    /* === FLOATING MESSENGER BUTTON === */
    .messenger-fab {
      position: fixed; bottom: 24px; right: 24px; width: 58px; height: 58px;
      border-radius: 50%; background: linear-gradient(135deg, #0084ff, #00c6ff);
      border: none; box-shadow: 0 6px 16px rgba(0,0,0,0.4);
      display: grid; place-items: center; cursor: pointer;
      transition: transform .2s, box-shadow .2s; z-index: 100;
    }
    .messenger-fab:hover { transform: scale(1.05); box-shadow: 0 8px 18px rgba(0,0,0,0.5); }
    .messenger-fab svg { width: 30px; height: 30px; fill: white; }
  </style>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="hstack">
          <div class="brand">üìö Q&A H∆∞·ªõng d·∫´n ch∆°i</div>
          <div class="search pill" style="flex:1">
            <div class="wrap">
              <svg width="18" height="18" viewBox="0 0 24 24"
                fill="none"><path
                  d="M21 21l-3.8-3.8M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z"
                  stroke="#9db0c5" stroke-width="1.5" /></svg>
              <input id="q"
                placeholder="T√¨m theo t·ª´ kh√≥a: giftcode, t√¢n th·ªß, s·ª©c m·∫°nh, boss..."
                autocomplete="off" />
            </div>
            <span class="kbd">/</span>
          </div>
        </div>

        <div class="toolbar">
          <select id="catSel" title="L·ªçc theo th·ªÉ lo·∫°i"></select>
          <button id="clear">X√≥a l·ªçc</button>
          <span id="count" class="counter">‚Äî</span>
        </div>
      </div>
    </header>

    <main class="container">
      <div id="list" class="grid" aria-live="polite"></div>
      <div id="empty" class="empty" style="display:none">Kh√¥ng t√¨m th·∫•y
        k·∫øt qu·∫£.</div>
    </main>

    <footer class="container">
      G·ª£i √Ω: nh·∫•n <span class="kbd">/</span> ƒë·ªÉ b·∫≠t nhanh √¥ t√¨m ki·∫øm ‚Ä¢ b·∫•m
      üîó ƒë·ªÉ copy link t·ªõi c√¢u h·ªèi
    </footer>

    <!-- Lightbox -->
    <dialog id="light">
      <div class="light-wrap">
        <div class="light-top">
          <div class="muted">Xem ·∫£nh</div>
          <button onclick="light.close()">ƒê√≥ng</button>
        </div>
        <img id="lightImg" alt>
      </div>
    </dialog>

    <!-- FAB Messenger -->
    <button class="messenger-fab" id="messengerFab"
      aria-label="M·ªü chat Messenger fanpage" title="Chat Fanpage">
      <svg viewBox="0 0 36 36" aria-hidden="true" focusable="false">
        <path
          d="M18 3C9.716 3 3 9.268 3 17.5c0 4.39 1.994 8.317 5.183 10.943.202.162.327.401.34.659l.07 4.102a.9.9 0 0 0 1.297.79l4.581-2.226a1.05 1.05 0 0 1 .6-.083c.877.128 1.78.195 2.63.195 8.284 0 15-6.268 15-14.5S26.284 3 18 3Zm8.088 10.78-4.957 5.26a1.8 1.8 0 0 1-2.444.175l-2.62-2.094a.9.9 0 0 0-1.13-.014l-5.08 3.91c-.636.49-1.48-.283-1.04-.95l4.957-5.26a1.8 1.8 0 0 1 2.444-.175l2.62 2.094a.9.9 0 0 0 1.13.014l5.08-3.91c.635-.49 1.48.283 1.04.95Z" />
      </svg>
    </button>
    <link rel="preconnect" href="https://m.me">

    <script>
    // ====== CONFIG MESSENGER FANPAGE (ƒëi·ªÅn username ch√≠nh x√°c) ======
    const PAGE_USERNAME = "ngocrongnthevmax";
    // ================================================================

    const qs = s => document.querySelector(s);
    const qsa = s => Array.from(document.querySelectorAll(s));
    const listEl = qs('#list'), countEl = qs('#count'), catSel = qs('#catSel'), qInput = qs('#q');
    const light = qs('#light'), lightImg = qs('#lightImg');

    let RAW = null, FLAT = [], SHOW = [];
    let VIEW_MAP = loadViews(); // { id: count }

    // --- Boot ---
    (async function boot(){
      const res = await fetch('./qas.json', { cache:'no-cache' });
      RAW = await res.json();
      FLAT = flatten(RAW.categories);
      buildCatSelect(RAW.categories);
      applyFromURL();
      render();
      bindGlobal();
    })().catch(e=>{
      listEl.innerHTML = `<div class="empty">Kh√¥ng t·∫£i ƒë∆∞·ª£c <b>qas.json</b>. Ki·ªÉm tra ƒë∆∞·ªùng d·∫´n.</div>`;
      console.error(e);
    });

    // --- Helpers ---
    function flatten(cats){
      return cats.flatMap(c =>
        (c.items || []).map(it => ({
          ...it, _catId: c.id, _catName: c.name
        }))
      );
    }

    function buildCatSelect(cats){
      catSel.innerHTML = `<option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>` +
        cats.map(c => `<option value="${esc(c.id)}">${esc(c.name)}</option>`).join('');
    }

    function render(){
      const items = filterItems();
      SHOW = items;
      countEl.textContent = `${items.length} k·∫øt qu·∫£`;
      if (!items.length){
        listEl.innerHTML = '';
        qs('#empty').style.display = 'block';
        return;
      }
      qs('#empty').style.display = 'none';

      const q = (qInput.value || '').trim().toLowerCase();
      listEl.innerHTML = items.map(renderCard.bind(null,q)).join('');

      // actions: toggle + copy + lightbox
      qsa('.q-toggle').forEach(el=>{
        el.addEventListener('click', () => toggleAnswer(el.dataset.id));
      });
      qsa('[data-copy]').forEach(btn=>{
        btn.addEventListener('click', e=>{
          e.stopPropagation();
          const id = btn.dataset.copy;
          const url = `${location.origin}${location.pathname}#${encodeURIComponent(id)}`;
          navigator.clipboard.writeText(url).then(()=>{
            btn.textContent = '‚úÖ Copied';
            setTimeout(()=>btn.textContent='üîó Link',1000);
          });
        });
      });
      qsa('[data-img]').forEach(a=>{
        a.addEventListener('click', e=>{
          e.preventDefault(); e.stopPropagation();
          lightImg.src = a.getAttribute('href'); light.showModal();
        });
      });

      // auto-open if hash matches
      const hid = decodeURIComponent((location.hash||'').slice(1));
      if (hid){
        openAnswer(hid, true);
      }
    }

    function renderCard(q, it){
      const title = highlight(it.q, q);
      const intro  = highlight(it.a_intro || '', q);
      const views = VIEW_MAP[it.id] || 0;

      const tags = (it.tags || []).map(t=>`<span class="tag">#${esc(t)}</span>`).join('');
      const imgs = (it.images||[]).map(src=>{
        const safe = esc(src);
        return `<a class="img" href="${safe}" data-img><img loading="lazy" src="${safe}" alt=""></a>`;
      }).join('');
      const steps = (it.a_steps||[]).map(s=>`<li>${highlight(s,q)}</li>`).join('');

      return `
      <article class="qa" id="${esc(it.id)}">
        <div class="q-head q-toggle" data-id="${esc(it.id)}" role="button" tabindex="0">
          <div class="q-icon">Q</div>
          <div class="q-title">${title}</div>
        </div>

        <div class="q-meta-row q-toggle" data-id="${esc(it.id)}" role="button" tabindex="0">
          <div class="q-meta-left">
            <span class="q-badge">${esc(it._catName)}</span>
            <span class="q-views" data-views="${esc(it.id)}">${views}</span>
          </div>
          <div class="q-actions">
            <button title="Copy link" data-copy="${esc(it.id)}">üîó Link</button>
          </div>
        </div>

        <div class="a-body" data-id="${esc(it.id)}">
          <p class="a-intro">${intro}</p>
          ${steps ? `<ol class="steps">${steps}</ol>` : ``}
          ${imgs ? `<div class="imgs">${imgs}</div>` : ``}
          ${tags ? `<div class="tags">${tags}</div>` : ``}
          <p class="muted" style="margin-top:8px">C·∫≠p nh·∫≠t: ${esc((RAW.updated_at||'').split('T')[0]||'‚Äî')}</p>
        </div>
      </article>`;
    }

    function filterItems(){
      const query = (qInput.value || '').trim().toLowerCase();
      const cat = catSel.value;
      let items = FLAT;
      if (cat) items = items.filter(i=> i._catId===cat);
      if (query){
        items = items.filter(i => (
          (i.q||'').toLowerCase().includes(query) ||
          (i.a_intro||'').toLowerCase().includes(query) ||
          (i._catName||'').toLowerCase().includes(query) ||
          (i.tags||[]).join(' ').toLowerCase().includes(query) ||
          (i.a_steps||[]).some(s=>(s||'').toLowerCase().includes(query))
        ));
      }
      return items;
    }

    function bindGlobal(){
      // search hotkey
      window.addEventListener('keydown',e=>{
        if (e.key === '/' && document.activeElement !== qInput){
          e.preventDefault(); qInput.focus();
        }
      });
      // clear
      qs('#clear').addEventListener('click', ()=>{
        qInput.value=''; catSel.value=''; render(); history.replaceState(null,'',location.pathname);
      });
      // events
      qInput.addEventListener('input', debounce(()=>render(), 80));
      catSel.addEventListener('change', ()=>render());

      // Messenger FAB
      document.getElementById("messengerFab").addEventListener("click", function(){
        const MME_URL = `https://m.me/${encodeURIComponent(PAGE_USERNAME)}`;
        const FANPAGE_URL = `https://facebook.com/${encodeURIComponent(PAGE_USERNAME)}`;
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        if (isMobile) window.location.href = MME_URL;
        else window.open(FANPAGE_URL, "_blank", "noopener,noreferrer");
      });

      // close lightbox esc
      document.addEventListener('keydown', e=>{ if (e.key==='Escape' && light.open) light.close(); });
    }

    // --- Views (localStorage) ---
    function loadViews(){
      try { return JSON.parse(localStorage.getItem('qa_views')||'{}'); }
      catch { return {}; }
    }
    function saveViews(){
      localStorage.setItem('qa_views', JSON.stringify(VIEW_MAP));
    }
    function incView(id){
      VIEW_MAP[id] = (VIEW_MAP[id]||0) + 1;
      saveViews();
      const el = qs(`[data-views="${css(id)}"]`);
      if (el) el.textContent = VIEW_MAP[id];
    }

    // Toggle/open answer
    function toggleAnswer(id){
      const body = qs(`.a-body[data-id="${css(id)}"]`);
      const isOpen = body.classList.contains('active');
      if (isOpen){
        body.classList.remove('active');
        history.replaceState(null,'',location.pathname);
      } else {
        openAnswer(id, false);
      }
    }
    function openAnswer(id, fromHash){
      const body = qs(`.a-body[data-id="${css(id)}"]`);
      if (!body) return;
      body.classList.add('active');
      if (!fromHash) incView(id); // ch·ªâ tƒÉng khi ng∆∞·ªùi d√πng v·ª´a m·ªü
      history.replaceState(null,'',`#${encodeURIComponent(id)}`);
      // scroll n·∫øu c·∫ßn
      body.scrollIntoView({behavior:'smooth',block:'start'});
    }

    function applyFromURL(){
      const u = new URL(location.href);
      const q = u.searchParams.get('q'); if (q) { qInput.value = q; }
      // #id x·ª≠ l√Ω sau render()
    }

    // utils
    function esc(s){ return (s??'').toString().replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function css(s){ return (s??'').toString().replace(/"/g,'\\"'); }
    function highlight(text, q){
      if (!q) return esc(text);
      const i = text.toLowerCase().indexOf(q);
      if (i<0) return esc(text);
      const before = esc(text.slice(0,i));
      const mid = esc(text.slice(i,i+q.length));
      const after = esc(text.slice(i+q.length));
      return `${before}<mark>${mid}</mark>${after}`;
    }
    function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; }
  </script>
  </body>
</html>
